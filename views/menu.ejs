<style>
    :root {
        --gold: #d6a45a;
        --gold-soft: #e3b873;
        --text: #f5f2ee;
        --muted: rgba(245, 242, 238, 0.7);
        --dark: #0a0a0a;
        --darker: #000;
    }
    .menu-section {
        padding: 2rem 0;
        position: relative;
        overflow: hidden;
    }
    .menu-section:before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(214, 164, 90, 0.3), transparent);
    }
    .menu-item {
        background: rgba(20, 20, 20, 0.8);
        border: 1px solid rgba(214, 164, 90, 0.2);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    .menu-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border-color: rgba(214, 164, 90, 0.4);
    }
    .menu-item h5 {
        color: var(--gold);
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    .price-tag {
        background: var(--gold);
        color: #000;
        padding: 0.25rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        display: inline-block;
        margin-top: 0.5rem;
    }
    .filter-btn {
        background: transparent;
        border: 1px solid var(--gold);
        color: var(--gold);
        padding: 0.5rem 1.5rem;
        margin: 0.25rem;
        border-radius: 30px;
        transition: all 0.3s ease;
        font-weight: 500;
        text-transform: uppercase;
        font-size: 0.8rem;
    }
    .filter-btn:hover, .filter-btn.active {
        background: var(--gold);
        color: #000;
        border-color: var(--gold);
    }
    .hero-section {
        position: relative;
        padding: 8rem 0 4rem;
    }
    .hero-section h1 {
        font-family: 'Playfair Display', serif;
        font-size: 3.5rem;
        font-weight: 700;
        color: var(--gold);
    }
    .menu-hover-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        margin-left: 1rem;
    }
    .reviews-btn {
        background-color: var(--gold);
        color: var(--dark);
        border: none;
        border-radius: 20px;
        padding: 0.3rem 0.8rem;
        font-size: 0.8rem;
        transition: all 0.3s ease;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .reviews-btn:hover {
        background-color: var(--gold-soft);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(214, 164, 90, 0.4);
    }

    .reviews-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    /* Swiggy-style Menu Cards */
    .menu-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .menu-card {
        background: var(--secondary);
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        position: relative;
        height: 380px;
        display: flex;
        flex-direction: column;
    }

    .menu-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 12px 24px rgba(214, 164, 90, 0.25);
    }

    .menu-card-image {
        width: 100%;
        height: 220px;
        object-fit: contain;
        object-position: center;
        border-radius: 16px 16px 0 0;
        transition: transform 0.3s ease;
        flex-shrink: 0;
        background: var(--dark);
    }

    .menu-card:hover .menu-card-image {
        transform: scale(1.08);
    }

    .menu-card-content {
        padding: 1.2rem;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    .menu-card-title {
        font-family: 'Playfair Display', serif;
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 0.6rem;
        line-height: 1.2;
        flex-shrink: 0;
    }

    .menu-card-description {
        color: var(--gold-soft);
        font-size: 0.85rem;
        line-height: 1.4;
        margin-bottom: 0.8rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        flex-grow: 1;
        min-height: 2.8rem;
    }

    .menu-card-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 0.8rem;
        border-top: 1px solid rgba(214, 164, 90, 0.2);
        margin-top: auto;
        flex-shrink: 0;
    }

    .menu-card-price {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--gold);
        flex-shrink: 0;
    }

    .menu-card-actions {
        display: flex;
        gap: 0.8rem;
        flex-shrink: 0;
    }

    .menu-card-add {
        background: var(--gold);
        color: var(--dark);
        border: none;
        border-radius: 10px;
        padding: 0.6rem 1.2rem;
        font-size: 0.9rem;
        font-weight: 600;
        transition: all 0.3s ease;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        flex-shrink: 0;
    }

    .menu-card-add:hover {
        background: var(--gold-soft);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(214, 164, 90, 0.3);
    }

    /* Responsive adjustments */
    @media (max-width: 1200px) {
        .menu-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (max-width: 900px) {
        .menu-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 600px) {
        .menu-grid {
            grid-template-columns: 1fr;
        }
        
        .menu-card {
            height: 340px;
        }
        
        .menu-card-image {
            height: 200px;
        }
    }
</style>

<section class="hero-section text-center">
    <div class="hero-content">
        <img src="/assets/logo-icon.png" alt="Rabuste Coffee Logo" class="hero-logo" style="display:block; margin:0 auto 20px auto; width:120px;">
        <h1 class="font-playfair display-1 fw-bold mb-4 text-white hero-title" style="background: linear-gradient(45deg, var(--gold), var(--gold-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Our Menu</h1>
        <p class="lead mb-5 fs-4 text-white hero-subtitle">Discover our carefully crafted selection of premium coffee and delicious treats</p>
    </div>
    <div class="particles"></div>
</section>

<section class="py-5" style="background: var(--secondary);" id="menu-wrapper">
    <div class="container mt-5">
        <div class="text-center">
            <div class="btn-group flex-wrap menu-filters" role="group" id="menu-filters">
                <a href="#all" class="filter-btn active" data-filter="all">All Items</a>
                <a href="#cold" class="filter-btn" data-filter="cold">Cold</a>
                <a href="#hot" class="filter-btn" data-filter="hot">Hot</a>
                <a href="#manual-brew" class="filter-btn" data-filter="manual-brew">Manual Brew</a>
                <a href="#shakes-tea" class="filter-btn" data-filter="shakes-tea">Shakes & Tea</a>
                <a href="#food" class="filter-btn" data-filter="food">Food</a>
            </div>
        </div>
    </div>
</section>

<main class="container py-5" id="menu-content">
    <% 
    const categoryNames = {
        'cold': 'Cold Coffee',
        'hot': 'Hot Coffee',
        'manual-brew': 'Manual Brew',
        'shakes-tea': 'Shakes & Tea',
        'food': 'Food Menu'
    };
    const subCategoryNames = {
        'robusta-cold-non-milk': 'Non-Milk Based',
        'robusta-cold-milk': 'Milk Based',
        'robusta-hot-non-milk': 'Non-Milk Based',
        'robusta-hot-milk': 'Milk Based',
        'blend-cold-non-milk': 'Non-Milk Based',
        'blend-cold-milk': 'Milk Based',
        'blend-hot-non-milk': 'Non-Milk Based',
        'blend-hot-milk': 'Milk Based',
        'cold-brew': 'Cold Brew',
        'pour-over': 'Pour Over',
        'shakes': 'Shakes',
        'cold-tea': 'Cold Tea',
        'snacks-sides': 'Snacks & Sides',
        'bagels-croissants': 'Bagels & Croissants'
    };
    %>
    
    <% if (typeof menuItems !== 'undefined' && Object.keys(menuItems).length > 0) { %>
        <% Object.keys(menuItems).forEach(category => { %>
            <section class="py-5 menu-section" style="background: var(--secondary);" data-category="<%= category %>">
                <div class="container py-5">
                    <h2 class="font-playfair fs-2 fw-bold mb-5 text-center" style="color: var(--primary);">
                        <i class="fas fa-<%= category === 'cold' ? 'snowflake' : category === 'hot' ? 'fire' : category === 'manual-brew' ? 'coffee' : category === 'shakes-tea' ? 'blender' : 'utensils' %> me-3"></i>
                        <%= categoryNames[category] || category %>
                    </h2>
                                                        <% Object.keys(menuItems[category]).forEach(subCategory => { %>
                        <h4 class="font-playfair fw-bold mb-4" style="color: var(--primary);">
                            <%= subCategoryNames[subCategory] || subCategory %>
                        </h4>
                        <div class="menu-grid">
                            <% menuItems[category][subCategory].forEach(item => { %>
                                <div class="menu-card">
                                    <% if (item.image) { %>
                                        <img src="<%= item.image.startsWith('/') ? item.image : '/assets/menu_images/' + item.image %>" 
                                             class="menu-card-image" 
                                             alt="<%= item.name %>"
                                             onerror="this.src='/assets/placeholder-food.jpg'">
                                    <% } %>
                                    <div class="menu-card-content">
                                        <h5 class="menu-card-title"><%= item.name %></h5>
                                        <% if (item.description) { %>
                                            <p class="menu-card-description"><%= item.description %></p>
                                        <% } %>
                                        <div class="menu-card-footer">
                                            <span class="menu-card-price">â‚¹<%= item.price %></span>
                                            <button class="menu-card-add" onclick="addToCart('<%= item.name %>', <%= item.price %>)">
                                                Add +
                                            </button>
                                        </div>
                                        <% 
const itemImage = item.image ? (item.image.startsWith('/') ? item.image : '/assets/menu_images/' + item.image) : '';
const addToCartData = JSON.stringify([item._id, item.name, item.price, itemImage]);
const addToWishlistData = JSON.stringify([item._id, item.name, item.price, itemImage]);
%>
                                        <div class="mt-3 d-flex gap-2">
                                            <% if (isLoggedIn && currentUser) { %>
                                                <button class="btn btn-sm btn-outline-light" onclick="addToCart(...<%= addToCartData %>)">
                                                    <i class="fas fa-cart-plus me-1"></i> Add to Cart
                                                </button>
                                                <button class="btn btn-sm btn-outline-warning" onclick="addToWishlist(...<%= addToWishlistData %>)">
                                                    <i class="fas fa-heart me-1"></i> Wishlist
                                                </button>
                                            <% } else { %>
                                                <a href="/signin" class="btn btn-sm btn-outline-light">
                                                    <i class="fas fa-sign-in-alt me-1"></i> Sign in to Order
                                                </a>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    <% }); %>
                </div>
            </section>
        <% }); %>
    <% } else { %>
        <div class="text-center py-5">
            <p class="text-muted">No menu items available at the moment.</p>
        </div>
    <% } %>
</main>

<script>
    // Toggle reviews visibility
    function toggleReviews(button) {
        const itemId = button.getAttribute('data-item-id');
        const reviewsDiv = document.getElementById('reviews-' + itemId);
        
        if (reviewsDiv.style.display === 'none') {
            reviewsDiv.style.display = 'block';
            button.style.backgroundColor = 'var(--gold-soft)';
        } else {
            reviewsDiv.style.display = 'none';
            button.style.backgroundColor = 'var(--gold)';
        }
    }

    // Add to cart function
    function addToCart(itemName, price) {
        // Simple cart functionality - you can expand this
        console.log('Added to cart:', itemName, price);
        
        // Show a simple notification
        const notification = document.createElement('div');
        notification.className = 'cart-notification';
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gold);
            color: var(--dark);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        `;
        notification.textContent = `${itemName} added to cart!`;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 2000);
    }

    document.addEventListener('DOMContentLoaded', function() {
        const filterButtons = document.querySelectorAll('.filter-btn');
        const menuSections = document.querySelectorAll('.menu-section');
        
        filterButtons.forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const filter = this.getAttribute('data-filter');
                
                filterButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                menuSections.forEach(section => {
                    const sectionCategory = section.getAttribute('data-category');
                    if (filter === 'all' || sectionCategory === filter) {
                        section.style.display = 'block';
                    } else {
                        section.style.display = 'none';
                    }
                });
            });
        });
    });

    // Cart and Wishlist functions
    function addToCart(itemId, itemName, price, image) {
        if (!<%= typeof isLoggedIn !== 'undefined' ? isLoggedIn : false %>) {
            window.location.href = '/signin';
            return;
        }
        
        fetch('/api/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                itemId: itemId,
                name: itemName,
                price: price,
                image: image,
                quantity: 1
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Item added to cart!', 'success');
                updateCartCount();
            } else {
                showNotification(data.message || 'Failed to add item to cart', 'error');
            }
        })
        .catch(error => {
            console.error('Error adding to cart:', error);
            showNotification('Failed to add item to cart', 'error');
        });
    }

    function addToWishlist(itemId, itemName, price, image) {
        if (!<%= typeof isLoggedIn !== 'undefined' ? isLoggedIn : false %>) {
            window.location.href = '/signin';
            return;
        }
        
        fetch('/api/wishlist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                itemId: itemId,
                name: itemName,
                price: price,
                image: image
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Item added to wishlist!', 'success');
                updateWishlistCount();
            } else {
                showNotification(data.message || 'Failed to add item to wishlist', 'error');
            }
        })
        .catch(error => {
            console.error('Error adding to wishlist:', error);
            showNotification('Failed to add item to wishlist', 'error');
        });
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} position-fixed top-0 end-0 m-3`;
        notification.style.cssText = 'z-index: 9999; right: 20px; max-width: 300px;';
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            ${message}
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    function updateCartCount() {
        // Update cart count in navbar
        fetch('/api/cart/count')
        .then(response => response.json())
        .then(data => {
            const cartCount = document.querySelector('.cart-count');
            if (cartCount) {
                cartCount.textContent = data.count || 0;
            }
        })
        .catch(error => console.error('Error updating cart count:', error));
    }

    function updateWishlistCount() {
        // Update wishlist count in navbar
        fetch('/api/wishlist/count')
        .then(response => response.json())
        .then(data => {
            const wishlistCount = document.querySelector('.wishlist-count');
            if (wishlistCount) {
                wishlistCount.textContent = data.count || 0;
            }
        })
        .catch(error => console.error('Error updating wishlist count:', error));
    }
</script>
