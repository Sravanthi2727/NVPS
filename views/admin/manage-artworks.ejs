<!-- Add New Artwork Form -->
<div class="admin-card">
    <h3>
        <i class="fas fa-plus-circle me-2"></i><span id="formTitle">Add New Artwork</span>
    </h3>
    
    <form id="artworkForm" enctype="multipart/form-data">
        <input type="hidden" id="artworkId" name="artworkId">
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label">Title *</label>
                    <input type="text" class="form-control" id="title" name="title" required>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label">Artist *</label>
                    <input type="text" class="form-control" id="artist" name="artist" required>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="mb-3">
                    <label class="form-label">Category *</label>
                    <select class="form-select" id="category" name="category" required>
                        <option value="">Select Category</option>
                        <option value="painting">Painting</option>
                        <option value="photography">Photography</option>
                        <option value="sculpture">Sculpture</option>
                        <option value="digital">Digital Art</option>
                    </select>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="mb-3">
                    <label class="form-label">Price *</label>
                    <input type="number" class="form-control" id="price" name="price" step="0.01" required>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="mb-3">
                    <label class="form-label">Year</label>
                    <input type="number" class="form-control" id="year" name="year">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label">Medium</label>
                    <input type="text" class="form-control" id="medium" name="medium" placeholder="e.g., Oil on Canvas, Digital Print">
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label">Dimensions</label>
                    <input type="text" class="form-control" id="dimensions" name="dimensions" placeholder="e.g., 24x36 inches">
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" id="description" name="description" rows="4" placeholder="Describe artwork..."></textarea>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="mb-3">
                    <label class="form-label">Availability</label>
                    <select class="form-select" id="availability" name="availability">
                        <option value="In Stock">In Stock</option>
                        <option value="Limited Edition">Limited Edition</option>
                        <option value="One of a kind">One of a kind</option>
                        <option value="Open Edition">Open Edition</option>
                        <option value="Sold Out">Sold Out</option>
                    </select>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="mb-3">
                    <label class="form-label">Display Order</label>
                    <input type="number" class="form-control" id="displayOrder" name="displayOrder" value="0" placeholder="0 = first">
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="mb-3">
                    <label class="form-label">Available</label>
                    <select class="form-select" id="isAvailable" name="isAvailable">
                        <option value="true">Available</option>
                        <option value="false">Hidden</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Artwork Image <span id="imageRequired">*</span></label>
            <input type="file" class="form-control" id="image" name="image" accept="image/*">
            <small class="text-muted">Upload a high-quality image of artwork</small>
            <div id="currentImage" style="display: none; margin-top: 10px;">
                <small class="text-muted">Current image:</small><br>
                <img id="currentImagePreview" src="" alt="Current artwork" style="max-width: 200px; max-height: 150px; object-fit: cover; border-radius: 8px; border: 1px solid rgba(214, 164, 90, 0.3);">
            </div>
        </div>

        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary" id="submitBtn">
                <i class="fas fa-save me-2"></i><span id="submitText">Add Artwork</span>
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="resetForm()">
                <i class="fas fa-redo me-2"></i>Reset
            </button>
            <button type="button" class="btn btn-outline-secondary" id="cancelEditBtn" onclick="cancelEdit()" style="display: none;">
                <i class="fas fa-times me-2"></i>Cancel Edit
            </button>
        </div>
    </form>
</div>

<!-- Existing Artworks Table -->
<div class="admin-card">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Existing Artworks</h3>
        <span class="text-muted">Total: <%= typeof artworks !== 'undefined' ? artworks.length : 0 %> artworks</span>
    </div>
    
    <div class="admin-table">
        <table class="table">
            <thead>
                <tr>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Artist</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Availability</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% if (typeof artworks !== 'undefined' && artworks.length > 0) { %>
                    <% artworks.forEach(artwork => { %>
                        <tr>
                            <td>
                                <% if (artwork.image) { %>
                                    <img src="<%= artwork.image %>" alt="<%= artwork.title %>" class="artwork-image" style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; border: 1px solid rgba(214, 164, 90, 0.3);">
                                <% } else { %>
                                    <div style="width: 60px; height: 60px; background: #333; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-image text-muted"></i>
                                    </div>
                                <% } %>
                            </td>
                            <td><strong><%= artwork.title %></strong></td>
                            <td><%= artwork.artist %></td>
                            <td><span class="badge bg-info"><%= artwork.category %></span></td>
                            <td>â‚¹<%= artwork.price.toLocaleString() %></td>
                            <td>
                                <span class="badge <%= artwork.availability === 'In Stock' ? 'bg-success' : artwork.availability === 'Sold Out' ? 'bg-danger' : 'bg-warning' %>">
                                    <%= artwork.availability %>
                                </span>
                            </td>
                            <td>
                                <div class="btn-group">
                                    <button class="btn btn-outline-primary btn-sm" onclick="editArtwork('<%= artwork._id %>')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="deleteArtwork('<%= artwork._id %>')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    <% }); %>
                <% } else { %>
                    <tr>
                        <td colspan="7" class="text-center text-muted" style="padding: 2rem;">
                            <i class="fas fa-images text-muted" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i><br>
                            No artworks found.<br>
                            <small>Add artworks using the form above.</small>
                        </td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>
</div>

<!-- Add/Edit Artwork Modal -->
<div class="modal fade" id="artworkModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Add Artwork</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="artworkEditForm" enctype="multipart/form-data">
                    <input type="hidden" id="artworkId">
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Title *</label>
                                <input type="text" class="form-control" id="editTitle" required>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Artist *</label>
                                <input type="text" class="form-control" id="editArtist" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Category *</label>
                                <select class="form-select" id="editCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="painting">Painting</option>
                                    <option value="photography">Photography</option>
                                    <option value="sculpture">Sculpture</option>
                                    <option value="digital">Digital Art</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Price *</label>
                                <input type="number" class="form-control" id="editPrice" step="0.01" required>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Year</label>
                                <input type="number" class="form-control" id="editYear">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Medium</label>
                                <input type="text" class="form-control" id="editMedium" placeholder="e.g., Oil on Canvas, Digital Print">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Dimensions</label>
                                <input type="text" class="form-control" id="editDimensions" placeholder="e.g., 24x36 inches">
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="editDescription" rows="3" placeholder="Describe artwork..."></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Availability</label>
                                <select class="form-select" id="editAvailability">
                                    <option value="In Stock">In Stock</option>
                                    <option value="Limited Edition">Limited Edition</option>
                                    <option value="One of a kind">One of a kind</option>
                                    <option value="Open Edition">Open Edition</option>
                                    <option value="Sold Out">Sold Out</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Display Order</label>
                                <input type="number" class="form-control" id="editDisplayOrder" value="0" placeholder="0 = first">
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label">Available</label>
                                <select class="form-select" id="editIsAvailable">
                                    <option value="true">Available</option>
                                    <option value="false">Hidden</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Artwork Image</label>
                        <input type="file" class="form-control" id="editImage" accept="image/*">
                        <small class="text-muted">Leave empty to keep current image</small>
                        <div id="currentImagePreview" class="mt-2"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveArtwork()">
                    <i class="fas fa-save me-2"></i>Save Artwork
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Form submission
document.getElementById('artworkForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    try {
        const response = await fetch('/admin/api/add-artwork', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('Artwork added successfully!');
            this.reset();
            location.reload();
        } else {
            alert('Error adding artwork: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error adding artwork');
    }
});

function resetForm() {
    document.getElementById('artworkForm').reset();
}

async function editArtwork(id) {
    try {
        // Fetch artwork data
        const response = await fetch(`/admin/api/artwork/${id}`);
        const result = await response.json();
        
        if (result.success) {
            const artwork = result.artwork;
            
            // Populate modal with artwork data
            document.getElementById('modalTitle').textContent = 'Edit Artwork';
            document.getElementById('artworkId').value = artwork._id;
            document.getElementById('editTitle').value = artwork.title;
            document.getElementById('editArtist').value = artwork.artist;
            document.getElementById('editCategory').value = artwork.category;
            document.getElementById('editPrice').value = artwork.price;
            document.getElementById('editYear').value = artwork.year || '';
            document.getElementById('editMedium').value = artwork.medium || '';
            document.getElementById('editDimensions').value = artwork.dimensions || '';
            document.getElementById('editDescription').value = artwork.description || '';
            document.getElementById('editAvailability').value = artwork.availability || 'In Stock';
            document.getElementById('editDisplayOrder').value = artwork.displayOrder || 0;
            document.getElementById('editIsAvailable').value = artwork.isAvailable ? 'true' : 'false';
            
            // Show current image preview
            const imagePreview = document.getElementById('currentImagePreview');
            if (artwork.image) {
                imagePreview.innerHTML = `
                    <div class="d-flex align-items-center gap-2">
                        <img src="${artwork.image}" alt="Current image" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 1px solid #d6a45a;">
                        <small class="text-muted">Current image</small>
                    </div>
                `;
            } else {
                imagePreview.innerHTML = '<small class="text-muted">No current image</small>';
            }
            
            // Show modal
            new bootstrap.Modal(document.getElementById('artworkModal')).show();
        } else {
            alert('Error fetching artwork: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error fetching artwork');
    }
}

async function saveArtwork() {
    const artworkId = document.getElementById('artworkId').value;
    const isEdit = artworkId !== '';
    
    const formData = new FormData();
    
    // Add form fields
    formData.append('title', document.getElementById('editTitle').value);
    formData.append('artist', document.getElementById('editArtist').value);
    formData.append('category', document.getElementById('editCategory').value);
    formData.append('price', document.getElementById('editPrice').value);
    formData.append('year', document.getElementById('editYear').value);
    formData.append('medium', document.getElementById('editMedium').value);
    formData.append('dimensions', document.getElementById('editDimensions').value);
    formData.append('description', document.getElementById('editDescription').value);
    formData.append('availability', document.getElementById('editAvailability').value);
    formData.append('displayOrder', document.getElementById('editDisplayOrder').value);
    formData.append('isAvailable', document.getElementById('editIsAvailable').value);
    
    // Add image if selected
    const imageInput = document.getElementById('editImage');
    if (imageInput.files && imageInput.files[0]) {
        formData.append('image', imageInput.files[0]);
    }
    
    try {
        const url = isEdit ? `/admin/api/update-artwork/${artworkId}` : '/admin/api/add-artwork';
        const method = 'POST';
        
        const response = await fetch(url, {
            method: method,
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            bootstrap.Modal.getInstance(document.getElementById('artworkModal')).hide();
            alert(`Artwork ${isEdit ? 'updated' : 'added'} successfully!`);
            location.reload();
        } else {
            alert(`Error ${isEdit ? 'updating' : 'adding'} artwork: ` + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert(`Error ${isEdit ? 'updating' : 'adding'} artwork`);
    }
}

async function deleteArtwork(id) {
    if (confirm('Are you sure you want to delete this artwork?')) {
        try {
            const response = await fetch(`/admin/api/delete-artwork/${id}`, {
                method: 'DELETE'
            });
            
            const result = await response.json();
            
            if (result.success) {
                alert('Artwork deleted successfully!');
                location.reload();
            } else {
                alert('Error deleting artwork: ' + result.message);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error deleting artwork');
        }
    }
}
</script>