<!-- Cart Requests Content -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <p style="color: #ccc;">Manage customer cart orders and requests</p>
    </div>
</div>

<!-- Filters -->
<div class="admin-card mb-4">
    <div class="row g-3">
        <div class="col-md-4">
            <label class="form-label" style="color: #d6a45a;">Status</label>
            <select class="form-select bg-dark text-light border-secondary" id="statusFilter">
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label" style="color: #d6a45a;">Payment Method</label>
            <select class="form-select bg-dark text-light border-secondary" id="paymentFilter">
                <option value="">All Payment Methods</option>
                <option value="online">Online</option>
                <option value="cod">Cash on Delivery</option>
                <option value="cash">Cash</option>
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label" style="color: #d6a45a;">Search</label>
            <input type="text" class="form-control bg-dark text-light border-secondary" placeholder="Search by customer name or email..." id="searchInput">
        </div>
    </div>
</div>

<!-- Cart Requests Table -->
<div class="admin-card">
    <h3 class="mb-3">Cart Orders</h3>
    <div class="admin-table">
        <table class="table table-dark">
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Items</th>
                    <th>Address</th>
                    <th>Payment</th>
                    <th>Total</th>
                    <th>Order Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% if (typeof cartRequests !== 'undefined' && cartRequests.length > 0) { %>
                    <% cartRequests.forEach(order => { %>
                    <tr>
                        <td data-label="Customer">
                            <strong><%= order.customerName %></strong><br>
                            <small style="color: #ccc;"><%= order.customerEmail %></small>
                        </td>
                        <td data-label="Items">
                            <% if (order.items && order.items.length > 0) { %>
                                <% order.items.forEach((item, index) => { %>
                                    <div class="mb-1">
                                        <strong style="font-size: 0.9rem;"><%= item.name %></strong><br>
                                        <small style="color: #ccc;">Qty: <%= item.quantity %> × ₹<%= item.price %></small>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <span style="color: #ccc;">No items</span>
                            <% } %>
                        </td>
                        <td data-label="Delivery Address">
                            <% if (order.deliveryAddress) { %>
                                <small style="color: #ccc; line-height: 1.6;">
                                    <%= order.deliveryAddress.name %><br>
                                    <%= order.deliveryAddress.phone %><br>
                                    <%= order.deliveryAddress.address %><br>
                                    <%= order.deliveryAddress.city %><% if (order.deliveryAddress.state) { %>, <%= order.deliveryAddress.state %><% } %><br>
                                    <%= order.deliveryAddress.pincode %>
                                </small>
                            <% } else { %>
                                <span style="color: #999;">No address</span>
                            <% } %>
                        </td>
                        <td data-label="Payment">
                            <% if (order.paymentMethod === 'online') { %>
                                <span class="badge bg-success">Online</span>
                            <% } else if (order.paymentMethod === 'cod') { %>
                                <span class="badge bg-warning">COD</span>
                            <% } else if (order.paymentMethod === 'cash') { %>
                                <span class="badge bg-info">Cash</span>
                            <% } else { %>
                                <span class="badge bg-secondary"><%= order.paymentMethod || 'N/A' %></span>
                            <% } %>
                        </td>
                        <td data-label="Total">
                            <strong style="color: #d6a45a;">₹<%= order.totalAmount %></strong>
                        </td>
                        <td data-label="Date">
                            <%= new Date(order.orderDate || order.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) %>
                        </td>
                        <td data-label="Status">
                            <% if (order.status === 'pending') { %>
                                <span class="badge bg-warning">Pending</span>
                            <% } else if (order.status === 'completed') { %>
                                <span class="badge bg-success">Completed</span>
                            <% } else if (order.status === 'cancelled') { %>
                                <span class="badge bg-danger">Cancelled</span>
                            <% } else { %>
                                <span class="badge bg-secondary"><%= order.status %></span>
                            <% } %>
                        </td>
                        <td data-label="Actions">
                            <div class="btn-group" role="group">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewOrder('<%= order._id %>')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <% if (order.status === 'pending') { %>
                                <form method="POST" action="/admin/cart-requests/<%= order._id %>/update" class="d-inline">
                                    <input type="hidden" name="status" value="completed">
                                    <button type="submit" class="btn btn-sm btn-success" title="Mark as Completed">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </form>
                                <form method="POST" action="/admin/cart-requests/<%= order._id %>/update" class="d-inline">
                                    <input type="hidden" name="status" value="cancelled">
                                    <button type="submit" class="btn btn-sm btn-danger" title="Cancel Order">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </form>
                                <% } %>
                            </div>
                        </td>
                    </tr>
                    <% }); %>
                <% } else { %>
                    <tr>
                        <td colspan="8" class="text-center" style="color: #ccc; padding: 2rem;">
                            <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i><br>
                            No cart orders found.<br>
                            <small>Cart orders will appear here when customers place orders.</small>
                        </td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>
</div>

<script>
function viewOrder(orderId) {
    // Implement view order functionality
    alert('View order functionality would be implemented here for order: ' + orderId);
}
</script>